function Vector(){}function Matrix(){}function Line(){}function Plane(){}var Sylvester={version:"0.1.3",precision:1e-6};Vector.prototype={e:function(e){return e<1||e>this.elements.length?null:this.elements[e-1]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(e){var t=this.elements.length,n=e.elements||e;if(t!=n.length)return!1;do if(Math.abs(this.elements[t-1]-n[t-1])>Sylvester.precision)return!1;while(--t);return!0},dup:function(){return Vector.create(this.elements)},map:function(e){var t=[];return this.each(function(n,r){t.push(e(n,r))}),Vector.create(t)},each:function(e){var t,n=this.elements.length,r=n;do t=r-n,e(this.elements[t],t+1);while(--n)},toUnitVector:function(){var e=this.modulus();return 0===e?this.dup():this.map(function(t){return t/e})},angleFrom:function(e){var t=e.elements||e,n=this.elements.length;if(n!=t.length)return null;var r=0,i=0,s=0;if(this.each(function(e,n){r+=e*t[n-1],i+=e*e,s+=t[n-1]*t[n-1]}),i=Math.sqrt(i),s=Math.sqrt(s),i*s===0)return null;var o=r/(i*s);return o<-1&&(o=-1),o>1&&(o=1),Math.acos(o)},isParallelTo:function(e){var t=this.angleFrom(e);return null===t?null:t<=Sylvester.precision},isAntiparallelTo:function(e){var t=this.angleFrom(e);return null===t?null:Math.abs(t-Math.PI)<=Sylvester.precision},isPerpendicularTo:function(e){var t=this.dot(e);return null===t?null:Math.abs(t)<=Sylvester.precision},add:function(e){var t=e.elements||e;return this.elements.length!=t.length?null:this.map(function(e,n){return e+t[n-1]})},subtract:function(e){var t=e.elements||e;return this.elements.length!=t.length?null:this.map(function(e,n){return e-t[n-1]})},multiply:function(e){return this.map(function(t){return t*e})},x:function(e){return this.multiply(e)},dot:function(e){var t=e.elements||e,n=0,r=this.elements.length;if(r!=t.length)return null;do n+=this.elements[r-1]*t[r-1];while(--r);return n},cross:function(e){var t=e.elements||e;if(3!=this.elements.length||3!=t.length)return null;var n=this.elements;return Vector.create([n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]])},max:function(){var e,t=0,n=this.elements.length,r=n;do e=r-n,Math.abs(this.elements[e])>Math.abs(t)&&(t=this.elements[e]);while(--n);return t},indexOf:function(e){var t,n=null,r=this.elements.length,i=r;do t=i-r,null===n&&this.elements[t]==e&&(n=t+1);while(--r);return n},toDiagonalMatrix:function(){return Matrix.Diagonal(this.elements)},round:function(){return this.map(function(e){return Math.round(e)})},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=Sylvester.precision?e:t})},distanceFrom:function(e){if(e.anchor)return e.distanceFrom(this);var t=e.elements||e;if(t.length!=this.elements.length)return null;var n,r=0;return this.each(function(e,i){n=e-t[i-1],r+=n*n}),Math.sqrt(r)},liesOn:function(e){return e.contains(this)},liesIn:function(e){return e.contains(this)},rotate:function(e,t){var n,r,i,s,o;switch(this.elements.length){case 2:return n=t.elements||t,2!=n.length?null:(r=Matrix.Rotation(e).elements,i=this.elements[0]-n[0],s=this.elements[1]-n[1],Vector.create([n[0]+r[0][0]*i+r[0][1]*s,n[1]+r[1][0]*i+r[1][1]*s]));case 3:if(!t.direction)return null;var l=t.pointClosestTo(this).elements;return r=Matrix.Rotation(e,t.direction).elements,i=this.elements[0]-l[0],s=this.elements[1]-l[1],o=this.elements[2]-l[2],Vector.create([l[0]+r[0][0]*i+r[0][1]*s+r[0][2]*o,l[1]+r[1][0]*i+r[1][1]*s+r[1][2]*o,l[2]+r[2][0]*i+r[2][1]*s+r[2][2]*o]);default:return null}},reflectionIn:function(e){if(e.anchor){var t=this.elements.slice(),n=e.pointClosestTo(t).elements;return Vector.create([n[0]+(n[0]-t[0]),n[1]+(n[1]-t[1]),n[2]+(n[2]-(t[2]||0))])}var r=e.elements||e;return this.elements.length!=r.length?null:this.map(function(e,t){return r[t-1]+(r[t-1]-e)})},to3D:function(){var e=this.dup();switch(e.elements.length){case 3:break;case 2:e.elements.push(0);break;default:return null}return e},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(e){return this.elements=(e.elements||e).slice(),this}},Vector.create=function(e){var t=new Vector;return t.setElements(e)},Vector.i=Vector.create([1,0,0]),Vector.j=Vector.create([0,1,0]),Vector.k=Vector.create([0,0,1]),Vector.Random=function(e){var t=[];do t.push(Math.random());while(--e);return Vector.create(t)},Vector.Zero=function(e){var t=[];do t.push(0);while(--e);return Vector.create(t)},Matrix.prototype={e:function(e,t){return e<1||e>this.elements.length||t<1||t>this.elements[0].length?null:this.elements[e-1][t-1]},row:function(e){return e>this.elements.length?null:Vector.create(this.elements[e-1])},col:function(e){if(e>this.elements[0].length)return null;var t,n=[],r=this.elements.length,i=r;do t=i-r,n.push(this.elements[t][e-1]);while(--r);return Vector.create(n)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(e){var t=e.elements||e;if("undefined"==typeof t[0][0]&&(t=Matrix.create(t).elements),this.elements.length!=t.length||this.elements[0].length!=t[0].length)return!1;var n,r,i,s=this.elements.length,o=s,l=this.elements[0].length;do{n=o-s,r=l;do if(i=l-r,Math.abs(this.elements[n][i]-t[n][i])>Sylvester.precision)return!1;while(--r)}while(--s);return!0},dup:function(){return Matrix.create(this.elements)},map:function(e){var t,n,r,i=[],s=this.elements.length,o=s,l=this.elements[0].length;do{t=o-s,n=l,i[t]=[];do r=l-n,i[t][r]=e(this.elements[t][r],t+1,r+1);while(--n)}while(--s);return Matrix.create(i)},isSameSizeAs:function(e){var t=e.elements||e;return"undefined"==typeof t[0][0]&&(t=Matrix.create(t).elements),this.elements.length==t.length&&this.elements[0].length==t[0].length},add:function(e){var t=e.elements||e;return"undefined"==typeof t[0][0]&&(t=Matrix.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,r){return e+t[n-1][r-1]}):null},subtract:function(e){var t=e.elements||e;return"undefined"==typeof t[0][0]&&(t=Matrix.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,r){return e-t[n-1][r-1]}):null},canMultiplyFromLeft:function(e){var t=e.elements||e;return"undefined"==typeof t[0][0]&&(t=Matrix.create(t).elements),this.elements[0].length==t.length},multiply:function(e){if(!e.elements)return this.map(function(t){return t*e});var t=!!e.modulus,n=e.elements||e;if("undefined"==typeof n[0][0]&&(n=Matrix.create(n).elements),!this.canMultiplyFromLeft(n))return null;var r,i,s,o,l,a,h=this.elements.length,u=h,c=n[0].length,m=this.elements[0].length,f=[];do{r=u-h,f[r]=[],i=c;do{s=c-i,o=0,l=m;do a=m-l,o+=this.elements[r][a]*n[a][s];while(--l);f[r][s]=o}while(--i)}while(--h);var n=Matrix.create(f);return t?n.col(1):n},x:function(e){return this.multiply(e)},minor:function(e,t,n,r){var i,s,o,l=[],a=n,h=this.elements.length,u=this.elements[0].length;do{i=n-a,l[i]=[],s=r;do o=r-s,l[i][o]=this.elements[(e+i-1)%h][(t+o-1)%u];while(--s)}while(--a);return Matrix.create(l)},transpose:function(){var e,t,n,r=this.elements.length,i=this.elements[0].length,s=[],o=i;do{e=i-o,s[e]=[],t=r;do n=r-t,s[e][n]=this.elements[n][e];while(--t)}while(--o);return Matrix.create(s)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){var e,t,n,r=0,i=this.elements.length,s=i,o=this.elements[0].length;do{e=s-i,t=o;do n=o-t,Math.abs(this.elements[e][n])>Math.abs(r)&&(r=this.elements[e][n]);while(--t)}while(--i);return r},indexOf:function(e){var t,n,r,i=this.elements.length,s=i,o=this.elements[0].length;do{t=s-i,n=o;do if(r=o-n,this.elements[t][r]==e)return{i:t+1,j:r+1};while(--n)}while(--i);return null},diagonal:function(){if(!this.isSquare)return null;var e,t=[],n=this.elements.length,r=n;do e=r-n,t.push(this.elements[e][e]);while(--n);return Vector.create(t)},toRightTriangular:function(){var e,t,n,r,i=this.dup(),s=this.elements.length,o=s,l=this.elements[0].length;do{if(t=o-s,0==i.elements[t][t])for(j=t+1;j<o;j++)if(0!=i.elements[j][t]){e=[],n=l;do r=l-n,e.push(i.elements[t][r]+i.elements[j][r]);while(--n);i.elements[t]=e;break}if(0!=i.elements[t][t])for(j=t+1;j<o;j++){var a=i.elements[j][t]/i.elements[t][t];e=[],n=l;do r=l-n,e.push(r<=t?0:i.elements[j][r]-i.elements[t][r]*a);while(--n);i.elements[j]=e}}while(--s);return i},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;var e,t=this.toRightTriangular(),n=t.elements[0][0],r=t.elements.length-1,i=r;do e=i-r+1,n*=t.elements[e][e];while(--r);return n},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;var e,t=this.elements[0][0],n=this.elements.length-1,r=n;do e=r-n+1,t+=this.elements[e][e];while(--n);return t},tr:function(){return this.trace()},rank:function(){var e,t,n,r=this.toRightTriangular(),i=0,s=this.elements.length,o=s,l=this.elements[0].length;do{e=o-s,t=l;do if(n=l-t,Math.abs(r.elements[e][n])>Sylvester.precision){i++;break}while(--t)}while(--s);return i},rk:function(){return this.rank()},augment:function(e){var t=e.elements||e;"undefined"==typeof t[0][0]&&(t=Matrix.create(t).elements);var n,r,i,s=this.dup(),o=s.elements[0].length,l=s.elements.length,a=l,h=t[0].length;if(l!=t.length)return null;do{n=a-l,r=h;do i=h-r,s.elements[n][o+i]=t[n][i];while(--r)}while(--l);return s},inverse:function(){if(!this.isSquare()||this.isSingular())return null;var e,t,n,r,i,s,o,l=this.elements.length,a=l,h=this.augment(Matrix.I(l)).toRightTriangular(),u=h.elements[0].length,c=[];do{e=l-1,i=[],n=u,c[e]=[],s=h.elements[e][e];do r=u-n,o=h.elements[e][r]/s,i.push(o),r>=a&&c[e].push(o);while(--n);for(h.elements[e]=i,t=0;t<e;t++){i=[],n=u;do r=u-n,i.push(h.elements[t][r]-h.elements[e][r]*h.elements[t][e]);while(--n);h.elements[t]=i}}while(--l);return Matrix.create(c)},inv:function(){return this.inverse()},round:function(){return this.map(function(e){return Math.round(e)})},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=Sylvester.precision?e:t})},inspect:function(){var e,t=[],n=this.elements.length,r=n;do e=r-n,t.push(Vector.create(this.elements[e]).inspect());while(--n);return t.join("\n")},setElements:function(e){var t,n=e.elements||e;if("undefined"!=typeof n[0][0]){var r,i,s,o=n.length,l=o;this.elements=[];do{t=l-o,r=n[t].length,i=r,this.elements[t]=[];do s=i-r,this.elements[t][s]=n[t][s];while(--r)}while(--o);return this}var a=n.length,h=a;this.elements=[];do t=h-a,this.elements.push([n[t]]);while(--a);return this}},Matrix.create=function(e){var t=new Matrix;return t.setElements(e)},Matrix.I=function(e){var t,n,r,i=[],s=e;do{t=s-e,i[t]=[],n=s;do r=s-n,i[t][r]=t==r?1:0;while(--n)}while(--e);return Matrix.create(i)},Matrix.Diagonal=function(e){var t,n=e.length,r=n,i=Matrix.I(n);do t=r-n,i.elements[t][t]=e[t];while(--n);return i},Matrix.Rotation=function(e,t){if(!t)return Matrix.create([[Math.cos(e),-Math.sin(e)],[Math.sin(e),Math.cos(e)]]);var n=t.dup();if(3!=n.elements.length)return null;var r=n.modulus(),i=n.elements[0]/r,s=n.elements[1]/r,o=n.elements[2]/r,l=Math.sin(e),a=Math.cos(e),h=1-a;return Matrix.create([[h*i*i+a,h*i*s-l*o,h*i*o+l*s],[h*i*s+l*o,h*s*s+a,h*s*o-l*i],[h*i*o-l*s,h*s*o+l*i,h*o*o+a]])},Matrix.RotationX=function(e){var t=Math.cos(e),n=Math.sin(e);return Matrix.create([[1,0,0],[0,t,-n],[0,n,t]])},Matrix.RotationY=function(e){var t=Math.cos(e),n=Math.sin(e);return Matrix.create([[t,0,n],[0,1,0],[-n,0,t]])},Matrix.RotationZ=function(e){var t=Math.cos(e),n=Math.sin(e);return Matrix.create([[t,-n,0],[n,t,0],[0,0,1]])},Matrix.Random=function(e,t){return Matrix.Zero(e,t).map(function(){return Math.random()})},Matrix.Zero=function(e,t){var n,r,i,s=[],o=e;do{n=e-o,s[n]=[],r=t;do i=t-r,s[n][i]=0;while(--r)}while(--o);return Matrix.create(s)},Line.prototype={eql:function(e){return this.isParallelTo(e)&&this.contains(e.anchor)},dup:function(){return Line.create(this.anchor,this.direction)},translate:function(e){var t=e.elements||e;return Line.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.direction)},isParallelTo:function(e){if(e.normal)return e.isParallelTo(this);var t=this.direction.angleFrom(e.direction);return Math.abs(t)<=Sylvester.precision||Math.abs(t-Math.PI)<=Sylvester.precision},distanceFrom:function(e){if(e.normal)return e.distanceFrom(this);if(e.direction){if(this.isParallelTo(e))return this.distanceFrom(e.anchor);var t=this.direction.cross(e.direction).toUnitVector().elements,n=this.anchor.elements,r=e.anchor.elements;return Math.abs((n[0]-r[0])*t[0]+(n[1]-r[1])*t[1]+(n[2]-r[2])*t[2])}var i=e.elements||e,n=this.anchor.elements,s=this.direction.elements,o=i[0]-n[0],l=i[1]-n[1],a=(i[2]||0)-n[2],h=Math.sqrt(o*o+l*l+a*a);if(0===h)return 0;var u=(o*s[0]+l*s[1]+a*s[2])/h,c=1-u*u;return Math.abs(h*Math.sqrt(c<0?0:c))},contains:function(e){var t=this.distanceFrom(e);return null!==t&&t<=Sylvester.precision},liesIn:function(e){return e.contains(this)},intersects:function(e){return e.normal?e.intersects(this):!this.isParallelTo(e)&&this.distanceFrom(e)<=Sylvester.precision},intersectionWith:function(e){if(e.normal)return e.intersectionWith(this);if(!this.intersects(e))return null;var t=this.anchor.elements,n=this.direction.elements,r=e.anchor.elements,i=e.direction.elements,s=n[0],o=n[1],l=n[2],a=i[0],h=i[1],u=i[2],c=t[0]-r[0],m=t[1]-r[1],f=t[2]-r[2],d=-s*c-o*m-l*f,v=a*c+h*m+u*f,g=s*s+o*o+l*l,p=a*a+h*h+u*u,M=s*a+o*h+l*u,w=(d*p/g+M*v)/(p-M*M);return Vector.create([t[0]+w*s,t[1]+w*o,t[2]+w*l])},pointClosestTo:function(e){if(e.direction){if(this.intersects(e))return this.intersectionWith(e);if(this.isParallelTo(e))return null;var t=this.direction.elements,n=e.direction.elements,r=t[0],i=t[1],s=t[2],o=n[0],l=n[1],a=n[2],h=s*o-r*a,u=r*l-i*o,c=i*a-s*l,m=Vector.create([h*a-u*l,u*o-c*a,c*l-h*o]),f=Plane.create(e.anchor,m);return f.intersectionWith(this)}var f=e.elements||e;if(this.contains(f))return Vector.create(f);var d=this.anchor.elements,t=this.direction.elements,r=t[0],i=t[1],s=t[2],v=d[0],g=d[1],p=d[2],h=r*(f[1]-g)-i*(f[0]-v),u=i*((f[2]||0)-p)-s*(f[1]-g),c=s*(f[0]-v)-r*((f[2]||0)-p),M=Vector.create([i*h-s*c,s*u-r*h,r*c-i*u]),w=this.distanceFrom(f)/M.modulus();return Vector.create([f[0]+M.elements[0]*w,f[1]+M.elements[1]*w,(f[2]||0)+M.elements[2]*w])},rotate:function(e,t){"undefined"==typeof t.direction&&(t=Line.create(t.to3D(),Vector.k));var n=Matrix.Rotation(e,t.direction).elements,r=t.pointClosestTo(this.anchor).elements,i=this.anchor.elements,s=this.direction.elements,o=r[0],l=r[1],a=r[2],h=i[0],u=i[1],c=i[2],m=h-o,f=u-l,d=c-a;return Line.create([o+n[0][0]*m+n[0][1]*f+n[0][2]*d,l+n[1][0]*m+n[1][1]*f+n[1][2]*d,a+n[2][0]*m+n[2][1]*f+n[2][2]*d],[n[0][0]*s[0]+n[0][1]*s[1]+n[0][2]*s[2],n[1][0]*s[0]+n[1][1]*s[1]+n[1][2]*s[2],n[2][0]*s[0]+n[2][1]*s[1]+n[2][2]*s[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.direction.elements,r=t[0],i=t[1],s=t[2],o=n[0],l=n[1],a=n[2],h=this.anchor.reflectionIn(e).elements,u=r+o,c=i+l,m=s+a,f=e.pointClosestTo([u,c,m]).elements,d=[f[0]+(f[0]-u)-h[0],f[1]+(f[1]-c)-h[1],f[2]+(f[2]-m)-h[2]];return Line.create(h,d)}if(e.direction)return this.rotate(Math.PI,e);var v=e.elements||e;return Line.create(this.anchor.reflectionIn([v[0],v[1],v[2]||0]),this.direction)},setVectors:function(e,t){if(e=Vector.create(e),t=Vector.create(t),2==e.elements.length&&e.elements.push(0),2==t.elements.length&&t.elements.push(0),e.elements.length>3||t.elements.length>3)return null;var n=t.modulus();return 0===n?null:(this.anchor=e,this.direction=Vector.create([t.elements[0]/n,t.elements[1]/n,t.elements[2]/n]),this)}},Line.create=function(e,t){var n=new Line;return n.setVectors(e,t)},Line.X=Line.create(Vector.Zero(3),Vector.i),Line.Y=Line.create(Vector.Zero(3),Vector.j),Line.Z=Line.create(Vector.Zero(3),Vector.k),Plane.prototype={eql:function(e){return this.contains(e.anchor)&&this.isParallelTo(e)},dup:function(){return Plane.create(this.anchor,this.normal)},translate:function(e){var t=e.elements||e;return Plane.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.normal)},isParallelTo:function(e){var t;return e.normal?(t=this.normal.angleFrom(e.normal),Math.abs(t)<=Sylvester.precision||Math.abs(Math.PI-t)<=Sylvester.precision):e.direction?this.normal.isPerpendicularTo(e.direction):null},isPerpendicularTo:function(e){var t=this.normal.angleFrom(e.normal);return Math.abs(Math.PI/2-t)<=Sylvester.precision},distanceFrom:function(e){if(this.intersects(e)||this.contains(e))return 0;if(e.anchor){var t=this.anchor.elements,n=e.anchor.elements,r=this.normal.elements;return Math.abs((t[0]-n[0])*r[0]+(t[1]-n[1])*r[1]+(t[2]-n[2])*r[2])}var i=e.elements||e,t=this.anchor.elements,r=this.normal.elements;return Math.abs((t[0]-i[0])*r[0]+(t[1]-i[1])*r[1]+(t[2]-(i[2]||0))*r[2])},contains:function(e){if(e.normal)return null;if(e.direction)return this.contains(e.anchor)&&this.contains(e.anchor.add(e.direction));var t=e.elements||e,n=this.anchor.elements,r=this.normal.elements,i=Math.abs(r[0]*(n[0]-t[0])+r[1]*(n[1]-t[1])+r[2]*(n[2]-(t[2]||0)));return i<=Sylvester.precision},intersects:function(e){return"undefined"==typeof e.direction&&"undefined"==typeof e.normal?null:!this.isParallelTo(e)},intersectionWith:function(e){if(!this.intersects(e))return null;if(e.direction){var t=e.anchor.elements,n=e.direction.elements,r=this.anchor.elements,i=this.normal.elements,s=(i[0]*(r[0]-t[0])+i[1]*(r[1]-t[1])+i[2]*(r[2]-t[2]))/(i[0]*n[0]+i[1]*n[1]+i[2]*n[2]);return Vector.create([t[0]+n[0]*s,t[1]+n[1]*s,t[2]+n[2]*s])}if(e.normal){for(var o=this.normal.cross(e.normal).toUnitVector(),i=this.normal.elements,t=this.anchor.elements,l=e.normal.elements,a=e.anchor.elements,h=Matrix.Zero(2,2),u=0;h.isSingular();)u++,h=Matrix.create([[i[u%3],i[(u+1)%3]],[l[u%3],l[(u+1)%3]]]);for(var c=h.inverse().elements,m=i[0]*t[0]+i[1]*t[1]+i[2]*t[2],f=l[0]*a[0]+l[1]*a[1]+l[2]*a[2],d=[c[0][0]*m+c[0][1]*f,c[1][0]*m+c[1][1]*f],v=[],g=1;g<=3;g++)v.push(u==g?0:d[(g+(5-u)%3)%3]);return Line.create(v,o)}},pointClosestTo:function(e){var t=e.elements||e,n=this.anchor.elements,r=this.normal.elements,i=(n[0]-t[0])*r[0]+(n[1]-t[1])*r[1]+(n[2]-(t[2]||0))*r[2];return Vector.create([t[0]+r[0]*i,t[1]+r[1]*i,(t[2]||0)+r[2]*i])},rotate:function(e,t){var n=Matrix.Rotation(e,t.direction).elements,r=t.pointClosestTo(this.anchor).elements,i=this.anchor.elements,s=this.normal.elements,o=r[0],l=r[1],a=r[2],h=i[0],u=i[1],c=i[2],m=h-o,f=u-l,d=c-a;return Plane.create([o+n[0][0]*m+n[0][1]*f+n[0][2]*d,l+n[1][0]*m+n[1][1]*f+n[1][2]*d,a+n[2][0]*m+n[2][1]*f+n[2][2]*d],[n[0][0]*s[0]+n[0][1]*s[1]+n[0][2]*s[2],n[1][0]*s[0]+n[1][1]*s[1]+n[1][2]*s[2],n[2][0]*s[0]+n[2][1]*s[1]+n[2][2]*s[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.normal.elements,r=t[0],i=t[1],s=t[2],o=n[0],l=n[1],a=n[2],h=this.anchor.reflectionIn(e).elements,u=r+o,c=i+l,m=s+a,f=e.pointClosestTo([u,c,m]).elements,d=[f[0]+(f[0]-u)-h[0],f[1]+(f[1]-c)-h[1],f[2]+(f[2]-m)-h[2]];return Plane.create(h,d)}if(e.direction)return this.rotate(Math.PI,e);var v=e.elements||e;return Plane.create(this.anchor.reflectionIn([v[0],v[1],v[2]||0]),this.normal)},setVectors:function(e,t,n){if(e=Vector.create(e),e=e.to3D(),null===e)return null;if(t=Vector.create(t),t=t.to3D(),null===t)return null;if("undefined"==typeof n)n=null;else if(n=Vector.create(n),n=n.to3D(),null===n)return null;var r,i,s=e.elements[0],o=e.elements[1],l=e.elements[2],a=t.elements[0],h=t.elements[1],u=t.elements[2];if(null!==n){var c=n.elements[0],m=n.elements[1],f=n.elements[2];if(r=Vector.create([(h-o)*(f-l)-(u-l)*(m-o),(u-l)*(c-s)-(a-s)*(f-l),(a-s)*(m-o)-(h-o)*(c-s)]),i=r.modulus(),0===i)return null;r=Vector.create([r.elements[0]/i,r.elements[1]/i,r.elements[2]/i])}else{if(i=Math.sqrt(a*a+h*h+u*u),0===i)return null;r=Vector.create([t.elements[0]/i,t.elements[1]/i,t.elements[2]/i])}return this.anchor=e,this.normal=r,this}},Plane.create=function(e,t,n){var r=new Plane;return r.setVectors(e,t,n)},Plane.XY=Plane.create(Vector.Zero(3),Vector.k),Plane.YZ=Plane.create(Vector.Zero(3),Vector.i),Plane.ZX=Plane.create(Vector.Zero(3),Vector.j),Plane.YX=Plane.XY,Plane.ZY=Plane.YZ,Plane.XZ=Plane.ZX;var $V=Vector.create,$M=Matrix.create,$L=Line.create,$P=Plane.create;!function(e){e.vr={}}(window.jwplayer),function(e){function t(e,t,n){var r;if("fragment"===n)r=e.createShader(e.FRAGMENT_SHADER);else{if("vertex"!==n)return null;r=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(r)),null)}function n(e,t,n,r,i,s,o,l,a){var h=$V([e,t,n]),u=$V([r,i,s]),c=$V([o,l,a]),m=h.subtract(u).toUnitVector(),f=c.cross(m).toUnitVector(),d=m.cross(f).toUnitVector(),v=$M([[f.e(1),f.e(2),f.e(3),0],[d.e(1),d.e(2),d.e(3),0],[m.e(1),m.e(2),m.e(3),0],[0,0,0,1]]),g=$M([[1,0,0,-e],[0,1,0,-t],[0,0,1,-n],[0,0,0,1]]);return v.x(g)}function r(e,t,n,r){var s=n*Math.tan(e*Math.PI/360),o=-s,l=o*t,a=s*t;return i(l,a,o,s,n,r)}function i(e,t,n,r,i,s){var o=2*i/(t-e),l=2*i/(r-n),a=(t+e)/(t-e),h=(r+n)/(r-n),u=-(s+i)/(s-i),c=-2*s*i/(s-i);return $M([[o,0,a,0],[0,l,h,0],[0,0,u,c],[0,0,-1,0]])}function s(e){return e*Math.PI/180}e.vr,e.utils,e._,e.events;Matrix.Scale=function(e){return e.push(1),Matrix.Diagonal(e)},Matrix.Translation=function(e){if(2==e.elements.length){var t=Matrix.I(3);return t.elements[2][0]=e.elements[0],t.elements[2][1]=e.elements[1],t}if(3==e.elements.length){var t=Matrix.I(4);return t.elements[0][3]=e.elements[0],t.elements[1][3]=e.elements[1],t.elements[2][3]=e.elements[2],t}throw"Invalid length for Translation"},Matrix.prototype.flatten=function(){var e=[];if(0==this.elements.length)return[];for(var t=0;t<this.elements[0].length;t++)for(var n=0;n<this.elements.length;n++)e.push(this.elements[n][t]);return e},Matrix.prototype.ensure4x4=function(){if(4==this.elements.length&&4==this.elements[0].length)return this;if(this.elements.length>4||this.elements[0].length>4)return null;for(var e=0;e<this.elements.length;e++)for(var t=this.elements[e].length;t<4;t++)e==t?this.elements[e].push(1):this.elements[e].push(0);for(var e=this.elements.length;e<4;e++)0==e?this.elements.push([1,0,0,0]):1==e?this.elements.push([0,1,0,0]):2==e?this.elements.push([0,0,1,0]):3==e&&this.elements.push([0,0,0,1]);return this},Matrix.prototype.make3x3=function(){return 4!=this.elements.length||4!=this.elements[0].length?null:Matrix.create([[this.elements[0][0],this.elements[0][1],this.elements[0][2]],[this.elements[1][0],this.elements[1][1],this.elements[1][2]],[this.elements[2][0],this.elements[2][1],this.elements[2][2]]])},Vector.prototype.flatten=function(){return this.elements},e.vr.utils={compileShader:t,makeLookAt:n,makePerspective:r,makeFrustum:i,degToRad:s}}(window.jwplayer),function(){var e=jwplayer.vr;e.events={UNSUPPORTED_BROWSER:"360° video playback is not supported in this browser.",INITIALIZATION_ERROR:"360° video playback initialization failed. Please try reloading the page."}}(),function(e){var t=e.vr;e.utils,e._,e.events;e.vr.quaternion=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1},e.vr.quaternion.prototype={constructor:t.quaternion,get x(){return this._x},set x(e){this._x=e},get y(){return this._y},set y(e){this._y=e},get z(){return this._z},set z(e){this._z=e},get w(){return this._w},set w(e){this._w=e},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,s=e._w,o=t._x,l=t._y,a=t._z,h=t._w;return this._x=n*h+s*o+r*a-i*l,this._y=r*h+s*l+i*o-n*a,this._z=i*h+s*a+n*l-r*o,this._w=s*h-n*o-r*l-i*a,this},clone:function(){return new e.vr.quaternion(this._x,this._y,this._z,this._w)}}}(window.jwplayer),function(e){var t=(e.vr,e.utils);e._,e.events;e.vr.videosphere=function(e,n,r,i,s,o,l){function a(){R=e.createProgram(),e.attachShader(R,s),e.attachShader(R,i),e.linkProgram(R),e.getProgramParameter(R,e.LINK_STATUS)||o.trigger("mediaError",{message:"Unable to initialize the shader program."}),e.useProgram(R),y=e.getAttribLocation(R,"a_Position"),e.enableVertexAttribArray(y),P=e.getAttribLocation(R,"a_TextureCoord"),e.enableVertexAttribArray(P)}function h(){var t=Math.max(1,Math.min(f,n));T=Math.pow(2,t-1)*d;for(var i,s,o,l,a,h,u=3*Math.pow(2,t),c=w/Math.pow(2,t),m=M/T,v=[],g=0;g<T;g++){var x=[],R=[],E=0,y=0;a=_,h=g*m;for(var P=0;P<u;P+=2)s=r*Math.sin(a),l=r*Math.cos(a),o=l*Math.sin(h),i=l*Math.cos(h),x[E++]=i,x[E++]=s,x[E++]=o,R[y++]=h/M,R[y++]=1-(a+_)/p,a-=c,h-=m/2,s=r*Math.sin(a),l=r*Math.cos(a),o=l*Math.sin(h),i=l*Math.cos(h),x[E++]=i,x[E++]=s,x[E++]=o,R[y++]=h/M,R[y++]=1-(a+_)/p,h+=m;S.push(x),v.push(R);var b=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,b),e.bufferData(e.ARRAY_BUFFER,new Float32Array(S[g]),e.STATIC_DRAW),A.push(b);var V=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,V),e.bufferData(e.ARRAY_BUFFER,new Float32Array(v[g]),e.STATIC_DRAW),L.push(V)}}function u(){x=e.createTexture(),e.bindTexture(e.TEXTURE_2D,x),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null)}function c(){0!==I.readyState&&1!==I.readyState&&I.currentTime!=F&&(e.bindTexture(e.TEXTURE_2D,x),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,m(I)),e.bindTexture(e.TEXTURE_2D,null),F=I.currentTime)}function m(e){if(j){var t=b||document.createElement("canvas"),n=V||t.getContext("2d");return t.width=e.videoWidth,t.height=e.videoHeight,n.clearRect(0,0,t.width,t.height),n.drawImage(e,0,0,t.width,t.height),t}return e}const f=5,d=5,v=3,g=2,p=Math.PI,M=2*p,w=M/3,_=p/2;var x,T,R,E,y,P,b,V,A=[],S=[],L=[],I=l,F=-1,j=t.isIE();a(),h(),u(),this.draw=function(t){c(),e.useProgram(R),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,x),E=e.getUniformLocation(R,"u_MVP"),e.uniformMatrix4fv(E,!1,new Float32Array(t.flatten()));for(var n=0;n<T;n++)e.bindBuffer(e.ARRAY_BUFFER,A[n]),e.vertexAttribPointer(y,v,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,L[n]),e.vertexAttribPointer(P,g,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,S[n].length/v)},this.setVideoElement=function(e){I=e,F=-1}}}(window.jwplayer),function(e){var t=e.vr;e.utils,e._,e.events;t.camera=function(e){function n(){d(),y.addEventListener("mousedown",o,!1),y.addEventListener("touchmove",u,!1),y.addEventListener("touchstart",h,!1),r()}function r(){s(y,w,M)}function i(){s(y,M,w)}function s(e,t,n){var r=e.style.cssText;r.indexOf(n)==-1&&(r.indexOf(t)!=-1?y.style.cssText=r.replace(t,n):y.style.cssText=r+n)}function o(e){i(),window.addEventListener("mousemove",a,!1),y.removeEventListener("mousedown",o,!1),window.addEventListener("mouseup",l,!1),e.preventDefault&&e.preventDefault(),P=!0,_=e.clientX,x=e.clientY}function l(e){r(),y.addEventListener("mousedown",o,!1),window.removeEventListener("mouseup",l,!1),window.removeEventListener("mousemove",a,!1),P=!1}function a(e){P&&c(e.clientX,e.clientY)}function h(e){e.preventDefault();var t=e.targetTouches[0];_=t.clientX,x=t.clientY}function u(e){e.preventDefault();for(var t=0;t<e.targetTouches.length;t++){var n=e.targetTouches[t];c(n.clientX,n.clientY)}}function c(e,t){var n=e-_,r=t-x,i=$V([n/g,r/g,0]),s=!0;b+=i.e(2),b>p&&(b=p,s=!1),b<-1.56&&(b=-1.56,s=!1);var o=R.subtract(T).cross(E);o=o.toUnitVector(),s&&m(i.e(2),o.e(1),o.e(2),o.e(3)),m(i.e(1),0,1,0),_=e,x=t}function m(e,n,r,i){var s=new t.quaternion,o=new t.quaternion,l=new t.quaternion;s.x=n*Math.sin(e/2),s.y=r*Math.sin(e/2),s.z=i*Math.sin(e/2),s.w=Math.cos(e/2),o.x=R.e(1),o.y=R.e(2),o.z=R.e(3),o.w=0;var a=s.clone(),l=s.multiply(o).multiply(a.conjugate());R.setElements([l.x,l.y,l.z])}function f(){return t.utils.makeLookAt(T.e(1),T.e(2),T.e(3),R.e(1),R.e(2),R.e(3),E.e(1),E.e(2),E.e(3))}function d(){T=$V([0,0,v]),R=$V([t.utils.degToRad(-90),0,0]),E=$V([0,1,0]),b=0}const v=.01,g=500,p=1.56,M="cursor: -moz-grab; cursor: -webkit-grab; cursor: grab;",w="cursor: -moz-grabbing; cursor: -webkit-grabbing; cursor: grabbing;";var _,x,T,R,E,y=e,P=!1,b=0;return n(),{getViewMatrix:f,reset:d}}}(window.jwplayer),function(e){var t=e.vr;t.shaders={},t.shaders.vertex="uniform mat4 u_MVP;\n\nattribute vec4 a_Position;\nattribute vec2 a_TextureCoord;\n\nvarying vec2 v_TextureCoord;\n\nvoid main() {\n   gl_Position = u_MVP * a_Position;\n   v_TextureCoord = a_TextureCoord;\n}\n",t.shaders.fragment="precision mediump float;\nvarying vec2 v_TextureCoord;\nuniform sampler2D u_Sampler;\n\nvoid main() {\n   vec2 v_TextureCoordFixed = v_TextureCoord;\n   // We need to correct out of range s and t coordinates here\n   v_TextureCoordFixed = mod(v_TextureCoordFixed, vec2(1.0, 1.0));\n   gl_FragColor = texture2D(u_Sampler, v_TextureCoordFixed);\n}\n"}(window.jwplayer),function(e){var t=e.vr,n=e.utils,r=(e._,e.events);r.state;t.controller=function(e,i,s){function o(){return!!window.WebGLRenderingContext&&(!n.isSafari()&&!(n.isIE()&&!n.isEdge()))}function l(){g(),M(),x=w.querySelector("canvas"),x=x||document.createElement("canvas"),_.parentNode.appendChild(x),x.classname="jw-video jw-reset jw-canvas",x.style.width="100%",x.style.height="100%",a(x),T&&(T.clearColor(0,0,0,0),T.clearDepth(1),T.enable(T.DEPTH_TEST),T.depthFunc(T.LEQUAL),h(),c(),V=t.utils.makePerspective(61,x.width/x.height,D,U),y=new t.videosphere(T,5,1,R,E,I,_),A=new t.camera(x),e.on("play",d),e.on(r.JWPLAYER_PLAYLIST_ITEM,m),e.on(r.JWPLAYER_AD_SKIPPED,g),e.on(r.JWPLAYER_AD_COMPLETE,g),e.on(r.JWPLAYER_AD_ERROR,p),e.on(r.JWPLAYER_AD_PLAY,f))}function a(n){T=null;try{T=n.getContext("experimental-webgl")}catch(i){console.error(i)}T||(e.dispatchEvent(r.JWPLAYER_ERROR,{message:t.events.INITIALIZATION_ERROR}),p())}function h(){R=t.utils.compileShader(T,t.shaders.fragment,"fragment"),E=t.utils.compileShader(T,t.shaders.vertex,"vertex")}function u(){T.clear(T.COLOR_BUFFER_BIT|T.DEPTH_BUFFER_BIT),c(),_viewMatrix=A.getViewMatrix(),b=_viewMatrix.x(P);var e=V.x(b);y.draw(e),i.debug&&j++,F&&window.requestAnimationFrame(u)}function c(){P=Matrix.I(4)}function m(){F=!1;var e=w.querySelector(".jw-media > video");e!==_&&(_=e,M(),g(),y.setVideoElement(_)),M(),A.reset()}function f(){F&&(F=!1),p()}function d(){F=!0,window.requestAnimationFrame(u),i.debug&&(L||(L=document.createElement("span"),L.style.color="white",s.appendChild(L)),S||(S=setInterval(v,C)))}function v(){var e=j/1;j=0,L.textContent="FPS: "+e}function g(){_.style.display="none"}function p(){_.style.display=""}function M(){if(!_.hasAttribute("crossorigin")&&"html5"===e.getProvider().name){var t=_.src,n=_.paused;_.src=null,_.setAttribute("crossorigin","anonymous"),_.src=t,n||_.play()}}var w,_,x,T,R,E,y,P,b,V,A,S,L,I=this,F=!1,j=0;const D=.1,U=100,C=1e3;e.on(r.JWPLAYER_READY,function(){return console.log("jwplayer-vr: onReady()"),w=e.getContainer(),(_=w.querySelector(".jw-media > video"))?void(o()?l():this.trigger(r.JWPLAYER_ERROR,{message:t.events.UNSUPPORTED_BROWSER})):void this.trigger(r.JWPLAYER_ERROR,{message:t.events.INITIALIZATION_ERROR})}),I.resize=function(e,n){x&&(x.width=e,x.height=n,T.viewport(0,0,x.width,x.height),V=t.utils.makePerspective(65,x.width/x.height,D,U))}},e().registerPlugin("vr","7.1",t.controller)}(window.jwplayer);